---
// Header.astro - Frical Alimentos
// Header glassmorphism futurista - versão melhorada

const menuItems = [
  { name: 'Sobre', href: '/sobre' },
  { 
    name: 'Produtos', 
    href: '/produtos',
    submenu: [
      { name: 'Prime Baby', href: '/produtos/prime-baby' },
      { name: 'Premium Grill', href: '/produtos/premium-grill' },
      { name: 'Tradicional Bovino', href: '/produtos/tradicional-bovino' },
      { name: 'Palatto Bovino', href: '/produtos/palatto-bovino' },
      { name: 'Palatto Suíno', href: '/produtos/palatto-suino' },
      { name: 'Tradicional Suíno', href: '/produtos/tradicional-suino' },
      { name: 'Carcaça Bovina', href: '/produtos/carcaca-bovina' },
      { name: 'Carcaça Suína', href: '/produtos/carcaca-suina' },
      { name: 'Miúdos', href: '/produtos/miudos' },
      { name: 'Pão de Queijo', href: '/produtos/pao-de-queijo' },
      { name: 'Industrializados', href: '/produtos/industrializados' },
    ]
  },
  { 
    name: 'Blog', 
    href: '/blog',
    submenu: [
      { name: 'Carnes', href: '/blog/carnes' },
      { name: 'Notícias', href: '/blog/noticias' },
      { name: 'Receitas', href: '/blog/receitas' },
    ]
  },
  { name: 'Política de Qualidade', href: '/politica-de-qualidade' },
  { 
    name: 'Contato', 
    href: 'https://api.whatsapp.com/send/?phone=553399198450&text&type=phone_number&app_absent=0',
    external: true 
  },
  { name: 'Trabalhe Conosco', href: '/trabalhe-conosco' },
];
---

<!-- Header Desktop e Mobile -->
<header id="main-header" class="fixed top-0 left-0 right-0 z-50">
  <!-- Container com padding para não colar nas bordas -->
  <div class="px-6 md:px-12 lg:px-20 pt-4 md:pt-6">
    <nav class="header-glass rounded-2xl max-w-[1400px] mx-auto">
      <div class="flex items-center justify-between px-6 md:px-8 py-4">
        
        <!-- Logo Desktop (esquerda) -->
        <a href="/" class="logo-hover hidden md:block flex-shrink-0">
          <img 
            src="/images/logo/logo.png" 
            alt="Frical Alimentos" 
            class="h-14 w-auto"
          />
        </a>

        <!-- Menu Desktop (centralizado) -->
        <div class="hidden md:flex flex-1 justify-center">
          <ul class="flex items-center gap-8 lg:gap-10">
            {menuItems.map((item) => (
              <li class="relative group">
                {item.submenu ? (
                  <div class="relative">
                    <!-- Link + Seta separados -->
                    <div class="flex items-center gap-2">
                      <a 
                        href={item.href}
                        class="nav-link font-book text-white text-[15px] py-2"
                      >
                        {item.name}
                      </a>
                      <button 
                        class="text-white/70 hover:text-white transition-colors p-1"
                        aria-label={`Abrir submenu de ${item.name}`}
                      >
                        <svg class="w-4 h-4 transition-transform duration-300 group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                      </button>
                    </div>
                    
                    <!-- Dropdown com espaçamento -->
                    <div class="absolute top-full left-1/2 -translate-x-1/2 pt-6 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 pointer-events-none group-hover:pointer-events-auto">
                      <ul class="dropdown-glass rounded-2xl py-4 min-w-[240px]">
                        {item.submenu.map((sub) => (
                          <li>
                            <a 
                              href={sub.href}
                              class="block px-6 py-3 font-book text-gray-700 text-[14px] hover:bg-black/5 hover:text-black transition-all"
                            >
                              {sub.name}
                            </a>
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                ) : (
                  <a 
                    href={item.href}
                    class="nav-link font-book text-white text-[15px] py-2"
                    target={item.external ? '_blank' : undefined}
                    rel={item.external ? 'noopener noreferrer' : undefined}
                  >
                    {item.name}
                  </a>
                )}
              </li>
            ))}
          </ul>
        </div>

        <!-- Espaço para balancear (desktop) -->
        <div class="hidden md:block w-[120px] flex-shrink-0"></div>

        <!-- Botão Menu Mobile (logo centralizado) -->
        <button 
          id="mobile-menu-btn"
          class="md:hidden flex-1 flex justify-center items-center py-1"
          aria-label="Abrir menu"
        >
          <div class="relative">
            <img 
              id="mobile-logo"
              src="/images/logo/logo.png" 
              alt="Frical Alimentos" 
              class="h-11 w-auto transition-all duration-500"
            />
            <span 
              id="mobile-close"
              class="absolute inset-0 flex items-center justify-center text-white text-2xl font-bold opacity-0 transition-all duration-500 pointer-events-none"
            >
              ✕
            </span>
          </div>
        </button>

      </div>
    </nav>
  </div>
</header>

<!-- Menu Mobile Overlay -->
<div 
  id="mobile-menu"
  class="fixed inset-0 z-40 md:hidden pointer-events-none opacity-0 transition-opacity duration-500"
>
  <!-- Backdrop -->
  <div id="mobile-backdrop" class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
  
  <!-- Menu Panel -->
  <div 
    id="mobile-panel"
    class="absolute left-6 right-6 top-28 mobile-menu-glass rounded-3xl p-8 transform -translate-y-8 opacity-0 transition-all duration-500"
  >
    <ul class="space-y-2">
      {menuItems.map((item, index) => (
        <li class="mobile-item" style={`--delay: ${index * 60}ms`}>
          {item.submenu ? (
            <div class="mobile-dropdown">
              <!-- Linha com link e seta separados -->
              <div class="flex items-center justify-between py-4 border-b border-gray-200">
                <a 
                  href={item.href}
                  class="font-book text-gray-800 text-lg hover:text-black transition-colors"
                >
                  {item.name}
                </a>
                <button 
                  class="mobile-dropdown-btn p-2 -mr-2 text-gray-500 hover:text-gray-800 transition-colors"
                  aria-label={`Abrir submenu de ${item.name}`}
                >
                  <svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
              </div>
              
              <!-- Submenu -->
              <ul class="mobile-submenu max-h-0 overflow-hidden transition-all duration-400 ease-out">
                {item.submenu.map((sub) => (
                  <li>
                    <a 
                      href={sub.href}
                      class="block py-3 pl-5 font-book text-gray-600 text-base hover:text-gray-900 transition-colors border-l-2 border-gray-200 hover:border-gray-400 ml-2"
                    >
                      {sub.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ) : (
            <a 
              href={item.href}
              class="block py-4 font-book text-gray-800 text-lg border-b border-gray-200 hover:text-black transition-colors"
              target={item.external ? '_blank' : undefined}
            >
              {item.name}
            </a>
          )}
        </li>
      ))}
    </ul>
  </div>
</div>

<!-- Espaçador do header fixo -->
<div class="h-28 md:h-32"></div>

<style>
  /* ===== Menu Mobile Ativo ===== */
  #mobile-menu.active {
    opacity: 1;
    pointer-events: auto;
  }
  
  #mobile-menu.active #mobile-panel {
    transform: translateY(0) perspective(1000px) rotateX(0deg);
    opacity: 1;
  }
  
  #mobile-panel {
    transform: translateY(-20px) perspective(1000px) rotateX(-8deg);
  }

  /* ===== Logo para X ===== */
  #mobile-menu-btn.active #mobile-logo {
    opacity: 0;
    transform: scale(0.5) rotate(180deg);
  }
  
  #mobile-menu-btn.active #mobile-close {
    opacity: 1;
    pointer-events: auto;
  }

  /* ===== Items do menu mobile animados ===== */
  .mobile-item {
    opacity: 0;
    transform: translateX(-30px);
    transition: all 0.4s ease;
    transition-delay: var(--delay);
  }
  
  #mobile-menu.active .mobile-item {
    opacity: 1;
    transform: translateX(0);
  }

  /* ===== Dropdown mobile ===== */
  .mobile-dropdown.open .mobile-dropdown-btn svg {
    transform: rotate(180deg);
  }
  
  .mobile-dropdown.open .mobile-submenu {
    max-height: 600px;
    padding-top: 8px;
    padding-bottom: 16px;
  }

  /* ===== Hover no dropdown desktop ===== */
  .group:hover .dropdown-glass {
    animation: dropdownFade 0.3s ease forwards;
  }

  @keyframes dropdownFade {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const backdrop = document.getElementById('mobile-backdrop');
    const dropdownBtns = document.querySelectorAll('.mobile-dropdown-btn');
    
    // Toggle menu mobile
    menuBtn?.addEventListener('click', () => {
      menuBtn.classList.toggle('active');
      mobileMenu?.classList.toggle('active');
      document.body.style.overflow = mobileMenu?.classList.contains('active') ? 'hidden' : '';
    });

    // Fechar ao clicar no backdrop
    backdrop?.addEventListener('click', () => {
      menuBtn?.classList.remove('active');
      mobileMenu?.classList.remove('active');
      document.body.style.overflow = '';
    });

    // Dropdowns mobile (só a seta abre/fecha)
    dropdownBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const dropdown = btn.closest('.mobile-dropdown');
        
        // Fecha outros dropdowns
        document.querySelectorAll('.mobile-dropdown.open').forEach(d => {
          if (d !== dropdown) d.classList.remove('open');
        });
        
        dropdown?.classList.toggle('open');
      });
    });

    // Fechar menu ao clicar em link (exceto setas)
    mobileMenu?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menuBtn?.classList.remove('active');
        mobileMenu?.classList.remove('active');
        document.body.style.overflow = '';
      });
    });
  });
</script>